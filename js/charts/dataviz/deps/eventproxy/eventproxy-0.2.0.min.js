/*
 * This file is used for define the EventProxy library.
 * @author <a href="mailto:shyvo1987@gmail.com">Jackson Tian</a>
 * @version 0.1.0
 */
(function(A,D){var B=typeof define==="function",C=typeof module!=="undefined"&&module.exports;if(B){define(D)}else{if(C){module.exports=D()}else{this[A]=D()}}})("EventProxy",function(){var A=function(){if(!(this instanceof A)){return new A()}this._callbacks={};this._fired={}};A.prototype.addListener=function(C,D){this._callbacks=this._callbacks||{};this._callbacks[C]=this._callbacks[C]||[];this._callbacks[C].push(D);return this};A.prototype.bind=A.prototype.addListener;A.prototype.on=A.prototype.addListener;A.prototype.await=A.prototype.addListener;A.prototype.removeListener=function(E,H){var C=this._callbacks,G,F;if(!E){this._callbacks={}}else{if(C){if(!H){C[E]=[]}else{var D=C[E];if(!D){return this}F=D.length;for(G=0;G<F;G++){if(H===D[G]){D[G]=null;break}}}}}return this};A.prototype.unbind=A.prototype.removeListener;A.prototype.removeAllListeners=function(C){return this.unbind(C)};A.prototype.trigger=function(C,F){var G,K,D,L,H,I,E;var J=2;if(!(K=this._callbacks)){return this}while(J--){D=J?C:"all";G=K[D];if(G){for(I=0,E=G.length;I<E;I++){if(!(L=G[I])){G.splice(I,1);I--;E--}else{H=J?Array.prototype.slice.call(arguments,1):arguments;L.apply(this,H)}}}}return this};A.prototype.emit=A.prototype.trigger;A.prototype.fire=A.prototype.trigger;A.prototype.once=function(C,F){var D=this;var E=function(){F.apply(D,arguments);D.unbind(C,E)};this.bind(C,E);return this};A.prototype.immediate=function(C,E,D){this.bind(C,E);this.trigger(C,D);return this};A.prototype.asap=A.prototype.immediate;var B=function(D,O,M,P){var G=this,N,H=0,I=arguments.length,Q,L,F,J,K,C=0,E={};if(I<3){return this}J=Array.prototype.slice.apply(arguments,[0,I-2]);F=arguments[I-2];K=arguments[I-1];if(typeof F!=="function"){return this}N=J.length;Q=function(S){var R=K?"once":"bind";G[R](S,function(T){G._fired[S]=G._fired[S]||{};G._fired[S].data=T;if(!E[S]){E[S]=true;C++}})};for(H=0;H<N;H++){Q(J[H])}L=function(R){if(C<N){return}if(!E[R]){return}var S=[];for(H=0;H<N;H++){S.push(G._fired[J[H]].data)}if(K){G.unbind("all",L)}F.apply(null,S)};G.bind("all",L)};A.prototype.all=function(C,D,F){var E=Array.prototype.concat.apply([],arguments);E.push(true);B.apply(this,E);return this};A.prototype.assign=A.prototype.all;A.prototype.fail=function(D){var C=this;C.once("error",function(E){C.unbind();D(E)});return this};A.prototype.tail=function(){var C=Array.prototype.concat.apply([],arguments);C.push(false);B.apply(this,C);return this};A.prototype.assignAll=A.prototype.tail;A.prototype.assignAlways=A.prototype.tail;A.prototype.after=function(G,F,H){if(F===0){H.call(null,[]);return this}var C=this,E=[],D;D=function(I,J){if(I===G){F--;E.push(J);if(F<1){C.unbind("all",D);H.apply(null,[E])}}};C.bind("all",D);return this};A.prototype.any=function(){var E=this,F,C,H=arguments.length,J=arguments[H-1],D=Array.prototype.slice.apply(arguments,[0,H-1]),I=D.length,G=D.join("_");E.once(G,J);C=function(K){E.bind(K,function(L){E.trigger(G,{"data":L,eventName:K})})};for(F=0;F<I;F++){C(D[F])}};A.prototype.not=function(D,E){var C=this;C.bind("all",function(F,G){if(F!==D){E(G)}})};A.prototype.done=function(D){var C=this;return function(E,G){if(E){return C.emit("error",E)}if(typeof D==="function"){return D(G)}var F=D;C.emit(F,G)}};A.create=function(){var D=new A();var C=Array.prototype.concat.apply([],arguments);if(C.length){var E=C[C.length-1];var F=C[C.length-2];if(typeof E==="function"&&typeof F==="function"){C.pop();D.fail(E)}D.assign.apply(D,Array.prototype.slice.call(C))}return D};A.EventProxy=A;return A});