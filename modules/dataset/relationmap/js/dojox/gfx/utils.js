/*!***********************************************
 Copyright (c) 2016, Neusoft Inc.
 All rights reserved
 SaCa DataViz Version 3.1.0
 ************************************************/
dojo._hasResource["dojox.gfx.utils"]||(dojo._hasResource["dojox.gfx.utils"]=!0,dojo.provide("dojox.gfx.utils"),dojo.require("dojox.gfx"),function(){var e=dojo,o=dojox.gfx,n=o.utils;dojo.mixin(n,{forEach:function(r,t,i){i=i||e.global,t.call(i,r),(r instanceof o.Surface||r instanceof o.Group)&&e.forEach(r.children,function(e){n.forEach(e,t,i)})},serialize:function(r){var t,i={},a=r instanceof o.Surface;if(a||r instanceof o.Group){if(i.children=e.map(r.children,n.serialize),a)return i.children}else i.shape=r.getShape();return r.getTransform&&(t=r.getTransform(),t&&(i.transform=t)),r.getStroke&&(t=r.getStroke(),t&&(i.stroke=t)),r.getFill&&(t=r.getFill(),t&&(i.fill=t)),r.getFont&&(t=r.getFont(),t&&(i.font=t)),i},toJson:function(o,r){return e.toJson(n.serialize(o),r)},deserialize:function(o,r){if(r instanceof Array)return e.map(r,e.hitch(null,n.deserialize,o));var t="shape"in r?o.createShape(r.shape):o.createGroup();return"transform"in r&&t.setTransform(r.transform),"stroke"in r&&t.setStroke(r.stroke),"fill"in r&&t.setFill(r.fill),"font"in r&&t.setFont(r.font),"children"in r&&e.forEach(r.children,e.hitch(null,n.deserialize,t)),t},fromJson:function(o,r){return n.deserialize(o,e.fromJson(r))},toSvg:function(e){var o=new dojo.Deferred;if("svg"===dojox.gfx.renderer)try{var r=n._cleanSvg(n._innerXML(e.rawNode));o.callback(r)}catch(t){o.errback(t)}else{n._initSvgSerializerDeferred||n._initSvgSerializer();var i=dojox.gfx.utils.toJson(e),a=function(){try{var r=e.getDimensions(),t=r.width,a=r.height,l=n._gfxSvgProxy.document.createElement("div");n._gfxSvgProxy.document.body.appendChild(l),dojo.withDoc(n._gfxSvgProxy.document,function(){dojo.style(l,"width",t),dojo.style(l,"height",a)},this);var d=n._gfxSvgProxy[dojox._scopeName].gfx.createSurface(l,t,a),c=function(e){try{n._gfxSvgProxy[dojox._scopeName].gfx.utils.fromJson(e,i);var r=n._cleanSvg(l.innerHTML);e.clear(),e.destroy(),n._gfxSvgProxy.document.body.removeChild(l),o.callback(r)}catch(t){o.errback(t)}};d.whenLoaded(null,c)}catch(f){o.errback(f)}};n._initSvgSerializerDeferred.fired>0?a():n._initSvgSerializerDeferred.addCallback(a)}return o},_gfxSvgProxy:null,_initSvgSerializerDeferred:null,_svgSerializerInitialized:function(){n._initSvgSerializerDeferred.callback(!0)},_initSvgSerializer:function(){if(!n._initSvgSerializerDeferred){n._initSvgSerializerDeferred=new dojo.Deferred;var e=dojo.doc.createElement("iframe");dojo.style(e,{display:"none",position:"absolute",width:"1em",height:"1em",top:"-10000px"});var o;dojo.isIE?e.onreadystatechange=function(){"complete"==e.contentWindow.document.readyState&&(e.onreadystatechange=function(){},o=setInterval(function(){e.contentWindow[dojo._scopeName]&&e.contentWindow[dojox._scopeName].gfx&&e.contentWindow[dojox._scopeName].gfx.utils&&(clearInterval(o),e.contentWindow.parent[dojox._scopeName].gfx.utils._gfxSvgProxy=e.contentWindow,e.contentWindow.parent[dojox._scopeName].gfx.utils._svgSerializerInitialized())},50))}:e.onload=function(){e.onload=function(){},o=setInterval(function(){e.contentWindow[dojo._scopeName]&&e.contentWindow[dojox._scopeName].gfx&&e.contentWindow[dojox._scopeName].gfx.utils&&(clearInterval(o),e.contentWindow.parent[dojox._scopeName].gfx.utils._gfxSvgProxy=e.contentWindow,e.contentWindow.parent[dojox._scopeName].gfx.utils._svgSerializerInitialized())},50)};var r=dojo.config.dojoxGfxSvgProxyFrameUrl||dojo.moduleUrl("dojox","gfx/resources/gfxSvgProxyFrame.html");e.setAttribute("src",r),dojo.body().appendChild(e)}},_innerXML:function(e){return e.innerXML?e.innerXML:e.xml?e.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(e):null},_cleanSvg:function(e){return e&&(-1==e.indexOf('xmlns="http://www.w3.org/2000/svg"')&&(e=e.substring(4,e.length),e='<svg xmlns="http://www.w3.org/2000/svg"'+e),e=e.replace(/\bdojoGfx\w*\s*=\s*(['"])\w*\1/g,"")),e}})}());