/*!***********************************************
 Copyright (c) 2016, Neusoft Inc.
 All rights reserved
 SaCa DataViz Version 3.1.0
 ************************************************/
var _semantics_diagram_plainArrow_cls={_surface:null,_startX:null,_startY:null,_endX:null,_endY:null,_arrowBone:null,_arrowPath:null,_arrowHead:null,_upperHead:null,_lowerHead:null,_notation:null,_color:null,_lineStyle:null,_eventSpace:null,_path:null,_arrowDirection:null,_center:null,_centerIcon:null,_centerSelectIcon:null,_selected:!1,constructor:function(){this._startX=0,this._startY=0,this._endX=0,this._endY=0,this._path=[],this._center={x:0,y:0}},setGraphicContext:function(t){this._surface=t.surface,t.color?this._color=t.color:this._color=_infosetStyle.lineColor,t.line?this._lineStyle=t.line:this._lineStyle="none",t.eventSpace&&(this._eventSpace=!0),this._initView()},_initView:function(){this._arrowPath=this._surface.createPath().setStroke({color:this._color,width:_infosetStyle.lineWidth,style:this._lineStyle}),this._arrowBone=this._surface.createLine({x1:this._startX,y1:this._startY,x2:this._endX,y2:this._endY}).setStroke({color:this._color,width:_infosetStyle.lineWidth,style:this._lineStyle}),this._arrowHead=this._surface.createGroup(),this._upperHead=this._arrowHead.createLine({x1:0,y1:0,x2:-8,y2:-4}).setStroke({color:this._color,width:_infosetStyle.lineWidth}),this._lowerHead=this._arrowHead.createLine({x1:0,y1:0,x2:-8,y2:4}).setStroke({color:this._color,width:_infosetStyle.lineWidth}),this._adjustShape()},setStart:function(t,e){this._startX=t,this._startY=e,this._adjustShape()},setEnd:function(t,e){this._endX=t,this._endY=e,this._eventSpace&&this._reviseXY(),this._adjustShape()},setEndPoints:function(t,e,i,s){this._startX=t,this._startY=e,this._endX=i,this._endY=s,this._eventSpace&&this._reviseXY(),this._adjustShape()},setPath:function(t,e,i){this._path=t,this._arrowDirection=e,this._center=i,this._adjustShape2()},setColor:function(t){this._color=t,this._arrowPath.setStroke({color:this._color,style:this._lineStyle}),this._upperHead.setStroke(this._color),this._lowerHead.setStroke(this._color)},setEmphasized:function(t){t?(this._arrowPath.setStroke({color:_infosetStyle.lineColorSelect,style:this._lineStyle,width:_infosetStyle.lineWidth}),this._upperHead.setStroke({color:_infosetStyle.lineColorSelect,width:_infosetStyle.lineWidth}),this._lowerHead.setStroke({color:_infosetStyle.lineColorSelect,width:_infosetStyle.lineWidth})):(this._arrowPath.setStroke({color:_infosetStyle.lineColor,style:this._lineStyle,width:_infosetStyle.lineWidth}),this._upperHead.setStroke({color:_infosetStyle.lineColor,width:_infosetStyle.lineWidth}),this._lowerHead.setStroke({color:_infosetStyle.lineColor,width:_infosetStyle.lineWidth}))},connectedit:function(t,e){this.editscope=t,this.editcallback=e},connectselect:function(t,e){this.selectscope=t,this.selectcallback=e},_reviseXY:function(){var t=this._endX-this._startX,e=Math.abs(t),i=this._endY-this._startY,s=Math.abs(i);e>1&&s>1&&(t>0&&t>s?this._endX--:i>0&&i>e?this._endY--:0>t&&-t>s?this._endX++:0>i&&-i>e&&this._endY++)},remove:function(){this._arrowHead.removeShape(),this._arrowBone.removeShape(),this._arrowPath.removeShape(),this._surface.removeShape()},_adjustShape:function(){if(this._arrowBone.setShape({x1:this._startX,y1:this._startY,x2:this._endX,y2:this._endY}),this._endX==this._startX&&this._endY==this._startY)this._arrowHead.setTransform({xx:0,yy:0});else{var t=this._endX==this._startX?this._endY>this._startY?Math.PI/2:-Math.PI/2:Math.atan((this._endY-this._startY)/(this._endX-this._startX)),e=dojox.gfx.matrix.normalize([{dx:this._endX,dy:this._endY},dojox.gfx.matrix.rotate(t)]);this._endX<this._startX&&(e=dojox.gfx.matrix.multiply(e,dojox.gfx.matrix.flipXY)),this._arrowHead.setTransform(e)}},changeArrowDirection:function(t){this._arrowDirection!=t&&(this._arrowDirection=t,this._adjustArrowDirection())},_adjustShape2:function(){for(var t="",e=0;e<this._path.length;e++)t+=0==e?"M"+(parseInt(this._path[e].x)+.5)+" "+(parseInt(this._path[e].y)+.5)+" L":parseInt(this._path[e].x)+.5+" "+(parseInt(this._path[e].y)+.5)+" ";this._arrowPath.setShape(t),this._adjustArrowDirection()},_adjustArrowDirection:function(){this.center={width:29,height:19},this._selected?this._centerSelectIcon&&this._surface.remove(this._centerSelectIcon):this._centerIcon&&this._surface.remove(this._centerIcon);var t=Math.round(this._center.x-this.center.width/2),e=Math.round(this._center.y-this.center.height/2);"left"==this._arrowDirection?(this._centerIcon=this._surface.createImage({x:t,y:e,width:this.center.width,height:this.center.height,src:_infosetStyle.leftIcon}),this._centerSelectIcon=this._surface.createImage({x:t,y:e,width:this.center.width,height:this.center.height,src:_infosetStyle.leftSelectIcon})):"right"==this._arrowDirection?(this._centerIcon=this._surface.createImage({x:t,y:e,width:this.center.width,height:this.center.height,src:_infosetStyle.rightIcon}),this._centerSelectIcon=this._surface.createImage({x:t,y:e,width:this.center.width,height:this.center.height,src:_infosetStyle.rightSelectIcon})):"outer"==this._arrowDirection?(this._centerIcon=this._surface.createImage({x:t,y:e,width:this.center.width,height:this.center.height,src:_infosetStyle.outerIcon}),this._centerSelectIcon=this._surface.createImage({x:t,y:e,width:this.center.width,height:this.center.height,src:_infosetStyle.outerSelectIcon})):(this._centerIcon=this._surface.createImage({x:t,y:e,width:this.center.width,height:this.center.height,src:_infosetStyle.innerIcon}),this._centerSelectIcon=this._surface.createImage({x:t,y:e,width:this.center.width,height:this.center.height,src:_infosetStyle.innerSelectIcon})),this._selected?this._surface.remove(this._centerIcon):this._surface.remove(this._centerSelectIcon),this._centerIcon.rawNode.style&&(this._centerIcon.rawNode.style.cursor="pointer"),this._centerSelectIcon.rawNode.style&&(this._centerSelectIcon.rawNode.style.cursor="pointer"),this.edithandle&&this._centerIcon.disconnect(this.edithandle),this.selecthandle&&this._centerIcon.disconnect(this.selecthandle),this.edithandleSelect&&this._centerSelectIcon.disconnect(this.edithandleSelect),this.selecthandleSelect&&this._centerSelectIcon.disconnect(this.selecthandleSelect),this.edithandle=this._centerIcon.connect("ondblclick",this.editscope,this.editcallback),this.selecthandle=this._centerIcon.connect("onclick",this.selectscope,this.selectcallback),this.edithandleSelect=this._centerSelectIcon.connect("ondblclick",this.editscope,this.editcallback),this.selecthandleSelect=this._centerSelectIcon.connect("onclick",this.selectscope,this.selectcallback)},selected:function(t){this._selected=t,this._selected?(this._surface.remove(this._centerIcon),this._surface.add(this._centerSelectIcon)):(this._surface.add(this._centerIcon),this._surface.remove(this._centerSelectIcon)),this.setEmphasized(this._selected)}};dojo.declare("semantics.diagram.PlainArrow",null,_semantics_diagram_plainArrow_cls);